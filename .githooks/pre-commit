 #!/bin/sh

echo "ğŸ”§ Spotless ê²€ì‚¬ ì¤‘..."

# í˜„ì¬ ìŠ¤í…Œì´ì§•ëœ Java íŒŒì¼ë§Œ ì¶”ì¶œ
STAGED=$(git diff --cached --name-only --diff-filter=ACM | grep '\.java$')


if [ -n "$STAGED" ]; then
  ./gradlew spotlessCheck > /dev/null 2>&1

  if [ $? -ne 0 ]; then
    echo "âš ï¸ í¬ë§·íŒ…ì´ ë§ì§€ ì•Šì•„ ìë™ìœ¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤..."
    ./gradlew spotlessApply

    echo "$STAGED" | xargs git add

    echo "âœ… ìˆ˜ì • ì™„ë£Œ. ë‹¤ì‹œ ì»¤ë°‹í•´ì£¼ì„¸ìš”."
    exit 1
  fi
fi

 echo "ğŸ” Running pre-commit hook..."

 # í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì„ íƒ)
 ./gradlew test
 if [ $? -ne 0 ]; then
     echo "âŒ Tests failed! Fix the issues before committing."
     exit 1
 fi
 exit 0

